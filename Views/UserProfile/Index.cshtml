@model SportBookingSystem.Models.ViewModels.UserProfileViewModel
@{
    ViewData["Title"] = "UserProfile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/profile.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
}

<!-- Profile Container -->
<div class="profile-container">

    <!-- Profile Header Card -->
    <div class="profile-header-card">
        <div class="profile-info">
            <div class="profile-avatar">
                <img src="~/asset/img/user.jpg" alt="Avatar" />
            </div>
            <div class="profile-details">
                <h1 class="profile-name">@Model.User.FullName</h1>
                <div class="profile-badges">
                    <span class="badge badge-vip">
                        <i class="fas fa-crown"></i>
                         @if(Model.User.RewardPoints >= 1000)
                         {
                             <span>Thành viên Kim Cương</span>
                         }
                         else if(Model.User.RewardPoints >= 500)
                         {
                             <span>Thành viên Bạch Kim</span>
                         }
                         else if(Model.User.RewardPoints >= 100)
                         {
                             <span>Thành viên Vàng</span>
                         }
                         else
                         {
                             <span>Thành viên Mới</span>
                         }
                    </span>
                    <span class="badge badge-points">
                        <i class="fas fa-gift"></i>
                        @Model.User.RewardPoints Điểm thưởng
                    </span>
                </div>
            </div>
        </div>

        <div class="profile-wallet">
            <div class="wallet-label">Số dư khả dụng</div>
            <div class="wallet-balances">@Model.User.WalletBalance.ToString("N0")₫</div>
            <button class="btn-recharge">
                <i class="fas fa-plus"></i>
                Nạp thêm tiền
            </button>
        </div>
    </div>

    <!-- Quick Reminder Section -->
    <section class="reminder-section">
        <h2 class="section-title">
            <i class="fas fa-bookmark"></i>
            Nhắc nhở quan trọng
        </h2>

        @if (Model.LatestOrder != null)
        {
            <div class="reminder-card order-reminder">
                <div class="reminder-icon" style="background: rgba(255, 159, 67, 0.1); color: #ff9f43;">
                    <i class="fas fa-utensils"></i>
                </div>
                <div class="reminder-content">
                    <h3 class="reminder-title">Đơn hàng đang chờ (#@Model.LatestOrder.OrderCode)</h3>
                    <p class="reminder-time" style="color: #ff9f43;">
                        <i class="far fa-clock"></i>
                        Vừa đặt lúc: @Model.LatestOrder.OrderDate.ToString("HH:mm dd/MM")
                    </p>
                    <p class="reminder-warning">
                        <i class="fas fa-info-circle"></i>
                        <span>Tổng tiền: @(Model.LatestOrder.TotalAmount?.ToString("N0"))₫ - @(Model.LatestOrder.OrderDetails.Count) món</span>
                    </p>
                </div>
                <button class="btn-checkin btn-order-qr" data-order-id="@Model.LatestOrder.OrderId" style="background: linear-gradient(135deg, #ff9f43, #ee5253);">
                    <i class="fas fa-qrcode"></i>
                    Lấy mã Order
                </button>
            </div>
        }
        else if (Model.UpcomingBooking != null)
        {
            <div class="reminder-card">
                <div class="reminder-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="reminder-content">
                    <h3 class="reminder-title">@Model.UpcomingBooking.Pitch.PitchName</h3>
                    <p class="reminder-time">
                        <i class="far fa-clock"></i>
                        @Model.UpcomingBooking.StartTime.ToString("HH:mm") - @Model.UpcomingBooking.EndTime.ToString("HH:mm") | @Model.UpcomingBooking.StartTime.ToString("dd/MM")
                    </p>
                    <p class="reminder-warning">
                        @if (Model.UpcomingBooking.TotalPrice > Model.UpcomingBooking.PaidAmount)
                        {
                            <i class="fas fa-exclamation-triangle"></i>
                             <span>Chưa thanh toán đủ: Thiếu @((Model.UpcomingBooking.TotalPrice - Model.UpcomingBooking.PaidAmount)?.ToString("N0"))₫</span>
                        }
                        else
                        {
                            <i class="fas fa-check-circle"></i>
                            <span>Đã thanh toán đủ</span>
                        }
                    </p>
                </div>
                 @if (!string.IsNullOrEmpty(Model.UpcomingBooking.CheckInCode))
                 {
                    <button class="btn-checkin" data-code="@Model.UpcomingBooking.CheckInCode">
                        <i class="fas fa-qrcode"></i>
                        Lấy mã Check-in
                    </button>
                 }
            </div>
        }
        else
        {
             <div class="reminder-card">
                 <div class="reminder-content">
                     <p>Bạn không có lịch đặt sân nào sắp tới.</p>
                 </div>
             </div>
        }
    </section>

    <!-- Quick Actions Section -->
    <section class="quick-actions-section">
        <h2 class="section-title">
            <i class="fas fa-bolt"></i>
            Tiện ích nhanh
        </h2>

        <div class="quick-actions-grid">
            <a href="@Url.Action("Index", "Booking")" class="action-card">
                <div class="action-icon" style="background: linear-gradient(135deg, #10B981, #059669);">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <span class="action-label">Đặt Sân Mới</span>
            </a>

            <a href="@Url.Action("Index", "Food")" class="action-card">
                <div class="action-icon" style="background: linear-gradient(135deg, #F59E0B, #D97706);">
                    <i class="fas fa-utensils"></i>
                </div>
                <span class="action-label">Menu / Canteen</span>
            </a>

            <a href="@Url.Action("Index", "History")" class="action-card">
                <div class="action-icon" style="background: linear-gradient(135deg, #3B82F6, #2563EB);">
                    <i class="fas fa-history"></i>
                </div>
                <span class="action-label">Lịch Sử Giao Dịch</span>
            </a>

            <a href="@Url.Action("Index", "Transaction")" class="action-card">
                <div class="action-icon" style="background: linear-gradient(135deg, #EC4899, #DB2777);">
                    <i class="fas fa-money-bill-transfer"></i>
                </div>
                <span class="action-label">Chuyển Tiền</span>
            </a>
        </div>
    </section>

    <!-- Personal Information Section -->
    <section class="personal-info-section">
        <h2 class="section-title">
            <i class="fas fa-user-shield"></i>
            Thông tin cá nhân
        </h2>

        <div class="info-card">
            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="info-content">
                    <span class="info-label">Email</span>
                    <span class="info-value">@Model.User.Email</span>
                </div>
                <!-- Email usually shouldn't be changed easily, but keeping UI as requested -->
                <button class="btn-change btn-change-email">
                    <i class="fas fa-pen"></i> Đổi
                </button>
            </div>


            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-phone"></i>
                </div>
                <div class="info-content">
                    <span class="info-label">Số điện thoại</span>
                    <span class="info-value">@Model.User.Phone</span>
                </div>
                <!-- Phone usually shouldn't be changed easily if it's login ID -->
                <button class="btn-change btn-change-phone">
                    <i class="fas fa-pen"></i> Đổi
                </button>
            </div>


            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <div class="info-content">
                    <span class="info-label">Mật khẩu</span>
                    <span class="info-value">••••••••</span>
                </div>
                <button class="btn-change btn-change-password">
                    <i class="fas fa-key"></i> Đổi mật khẩu
                </button>
            </div>
        </div>
    </section>

</div>

<!-- Modals -->
<div id="emailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Đổi Email</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Email mới</label>
                <input type="email" id="newEmail" placeholder="Nhập email mới..." class="form-control">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel">Hủy</button>
            <button class="btn-save" id="saveEmail">Lưu thay đổi</button>
        </div>
    </div>
</div>

<div id="phoneModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Đổi Số điện thoại</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Số điện thoại mới</label>
                <input type="text" id="newPhone" placeholder="Nhập số điện thoại mới..." class="form-control">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel">Hủy</button>
            <button class="btn-save" id="savePhone">Lưu thay đổi</button>
        </div>
    </div>
</div>

<div id="passwordModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Đổi Mật khẩu</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Mật khẩu hiện tại</label>
                <input type="password" id="currentPassword" placeholder="Nhập mật khẩu cũ..." class="form-control">
            </div>
            <div class="form-group">
                <label>Mật khẩu mới</label>
                <input type="password" id="newPassword" placeholder="Nhập mật khẩu mới..." class="form-control">
            </div>
            <div class="form-group">
                <label>Xác nhận mật khẩu</label>
                <input type="password" id="confirmPassword" placeholder="Nhập lại mật khẩu mới..." class="form-control">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel">Hủy</button>
            <button class="btn-save" id="savePassword">Lưu thay đổi</button>
        </div>
    </div>
</div>

<!-- Check-in QR Modal -->
<div id="checkInQrModal" class="modal">
    <div class="modal-content text-center">
        <div class="modal-header">
            <h3>Mã Check-in Đặt Sân</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <div class="qr-container p-3 mb-3">
                <img id="checkInQrImage" src="" alt="QR Check-in" style="max-width: 250px; width: 100%;">
                <p class="mt-2 text-muted" id="checkInCodeDisplay"></p>
                <div id="qrCountdown" class="mt-2 fw-bold text-danger" style="font-size: 1.1rem; display: none;">
                    Mã QR sẽ hết hạn sau: <span id="countdownTimer">15:00</span>
                </div>
            </div>
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> Vui lòng đưa mã này cho nhân viên tại sân để nhận sân.
            </div>
        </div>
        <div class="modal-footer justify-content-center">
            <button class="btn-cancel w-100">Đóng</button>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/profile.js"></script>
}
