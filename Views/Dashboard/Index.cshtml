@model SportBookingSystem.Models.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/LayoutAdmin.cshtml";
}
@section Styles {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="~/css/dashboard.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
}

<!-- Main Content -->
<div class="dashboard-container">
    <!-- Stats Cards -->
    <div class="stats-grid">
        <!-- Doanh thu hôm nay -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon money"><i class="bi bi-cash-coin"></i></div>
                <div class="stat-trend @(Model.IsRevenueGrowthPositive ? "up" : "down")">
                    <i class="fa-solid @(Model.IsRevenueGrowthPositive ? "fa-arrow-trend-up" : "fa-arrow-trend-down")"></i>

                    <span>
                        @(Model.IsRevenueGrowthPositive ? "+" : "-")@Model.RevenueGrowthPercent.ToString("0.0")%
                    </span>
                </div>
            </div>
            <div class="stat-value">@Model.TodayRevenue.ToString("#,##0")₫</div>
            <div class="stat-label">Doanh thu hôm nay</div>
        </div>

        <!-- Lượt đặt sân hôm nay -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon booking"><i class="bi bi-calendar-check-fill"></i></div>
                <div class="stat-trend @(Model.IsBookingGrowthPositive ? "up" : "down")">
                    @if (Model.IsBookingGrowthPositive)
                    {
                        <i class="fa-solid fa-arrow-trend-up" style="color: #28a745;"></i>
                        <span style="color: #28a745;">+@Model.BookingGrowthPercent.ToString("0.0")%</span>
                    }
                    else
                    {
                        <i class="fa-solid fa-arrow-trend-down" style="color: #dc3545;"></i>
                        <span style="color: #dc3545;">-@Model.BookingGrowthPercent.ToString("0.0")%</span>
                    }
                </div>
            </div>
            <div class="stat-value">@Model.TodayBookingsCount</div>
            <div class="stat-label">Lượt đặt sân hôm nay</div>
        </div>

        <!-- Sân đang hoạt động -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon field"><i class="bi bi-calendar-event-fill"></i></div>
                <div class="stat-trend up">
                    <span></span>
                    <span>Hoạt động</span>
                </div>
            </div>
            <div class="stat-value">@Model.ActivePitchesCount/@Model.TotalPitchesCount</div>
            <div class="stat-label">Sân đang hoạt động</div>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
        <!-- Revenue Chart -->
        <div class="card chart-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-title-icon"><i class="bi bi-graph-up-arrow"></i></span>
                    Doanh thu 7 ngày qua
                </h3>
            </div>
            <div class="chartjs-container">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <!-- Top Customers -->
        <div class="card activity-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-title-icon"><i class="bi bi-person-badge-fill"></i></span>
                    Top khách hàng đặt sân
                </h3>
            </div>
            <div class="activity-list">
                @if (Model.TopCustomers != null && Model.TopCustomers.Any())
                {
                    @foreach (var customer in Model.TopCustomers)
                    {
                        <div class="activity-item">
                            <div class="activity-icon booking">
                                <i class="bi bi-person-circle"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">@customer.CustomerName</div>
                                <div class="activity-time">@customer.BookingCount lượt - @customer.TotalAmount.ToString("#,##0")₫</div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center text-muted py-3">
                        <p>Chưa có dữ liệu khách hàng trong tháng này</p>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Bottom Grid -->
    <div class="bottom-grid">
        <!-- Top Fields -->
        <div class="card top-fields-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-title-icon"><i class="bi bi-trophy-fill"></i></span>
                    Top sân được đặt nhiều nhất
                </h3>
            </div>
            <div class="top-fields-list">
                @if (Model.TopPitches != null && Model.TopPitches.Any())
                {
                    @foreach (var pitch in Model.TopPitches)
                    {
                        var rankClass = pitch.Rank switch
                        {
                            1 => "gold",
                            2 => "silver",
                            3 => "bronze",
                            _ => ""
                        };

                        <div class="field-item">
                            <div class="field-rank @rankClass">@pitch.Rank</div>
                            <div class="field-details">
                                <div class="field-name">@pitch.PitchName</div>
                                <div class="field-bookings">@pitch.BookingCount lượt đặt tháng này</div>
                            </div>
                            <div class="field-revenue">@((pitch.TotalRevenue / 1000000).ToString("0.0"))M₫</div>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center text-muted py-3">
                        <p>Chưa có dữ liệu đặt sân trong tháng này</p>
                    </div>
                }
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card quick-actions-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-title-icon"><i class="bi bi-lightning-fill"></i></span>
                    Thao tác nhanh
                </h3>
            </div>
            <div class="quick-actions">
                <a asp-controller="ManageBookingAD" asp-action="Index" class="action-btn">
                    <div class="action-icon add"><i class="bi bi-plus-circle-fill"></i></div>
                    <div class="action-label">Thêm đặt sân mới</div>
                </a>
                <a asp-controller="BookingAD" asp-action="Index" class="action-btn">
                    <div class="action-icon field"><i class="bi bi-calendar-event-fill"></i></div>
                    <div class="action-label">Quản lý sân</div>
                </a>
                <a asp-controller="UserAD" asp-action="Index" class="action-btn">
                    <div class="action-icon users"><i class="bi bi-people-fill"></i></div>
                    <div class="action-label">Danh sách khách hàng</div>
                </a>
                <a asp-controller="ReportAD" asp-action="Index" class="action-btn">
                    <div class="action-icon report"><i class="bi bi-pie-chart-fill"></i></div>
                    <div class="action-label">Báo cáo chi tiết</div>
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        var chartData = @Html.Raw(Json.Serialize(Model.RevenueChart));
    </script>
    <script src="~/js/dashboard.js"></script>
}
