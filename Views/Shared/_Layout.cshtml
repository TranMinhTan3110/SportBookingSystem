@using System.Security.Claims
@using SportBookingSystem.Services
@inject ILoginServices LoginService

@{
    var userIdClaim = User.FindFirst(ClaimTypes.NameIdentifier);
    SportBookingSystem.Models.Entities.Users currentUser = null;
    if (userIdClaim != null && int.TryParse(userIdClaim.Value, out int userId))
    {
        currentUser = await LoginService.GetUserByIdAsync(userId);
    }
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - SportHub</title>
   
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- CSS Files -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">


    <link rel="stylesheet" href="~/css/site.css" />

    @await RenderSectionAsync("Styles", required: false)
</head>
<body>
    <!-- Dropdown Overlay -->
    <div class="dropdown-overlay" id="dropdownOverlay"></div>

    <!-- Mobile Navigation Overlay -->
    <div class="mobile-nav-overlay" id="mobileNavOverlay"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                <i class="bi bi-list"></i>
            </button>

            <!-- Logo -->
            <a href="@Url.Action("Index", "Home")" class="logo">
                <img src="~/asset/img/logo.png" alt="SportHub Logo" class="logo-icon" />
                <span>TQTSport</span>
            </a>

            <!-- Desktop Navigation Menu -->
            <nav class="nav-menu">
                <a href="@Url.Action("Index", "Home")"
                   class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" ? "active" : "")">
                    <i class="bi bi-house-door-fill"></i> Trang chủ
                </a>
                <a href="@Url.Action("Index", "Booking")"
                   class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Booking" ? "active" : "")">
                    <i class="bi bi-calendar-event-fill"></i> Đặt sân
                </a>

                <!-- Dịch Vụ Dropdown -->
                <div class="dropdown" id="servicesDropdown">
                    <button type="button" class="dropdown-toggle @(ViewContext.RouteData.Values["controller"]?.ToString() == "FoodDrinks" || ViewContext.RouteData.Values["controller"]?.ToString() == "Products" ? "active" : "")" >
                        <i class="bi bi-grid-fill"></i> Dịch vụ
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="dropdown-menu">
                        <a href="@Url.Action("Index", "Food")" class="dropdown-item">
                            <span class="dropdown-item-icon"><i class="bi bi-cup-hot-fill"></i></span>
                            <span>Đồ Ăn & Thức Uống</span>
                        </a>
                        <a href="@Url.Action("Index", "Supplies")" class="dropdown-item">
                            <span class="dropdown-item-icon"><i class="bi bi-bag-fill"></i></span>
                            <span>Đồ Dùng Thể Thao</span>
                        </a>
                    </div>
                </div>

                <a href="@Url.Action("Index", "History")"
                   class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "History" ? "active" : "")">
                    <i class="bi bi-clock-history"></i> Lịch sử
                </a>
            </nav>

            <!-- Header Actions -->
            <div class="header-actions">
                @if (User.Identity.IsAuthenticated && currentUser != null)
                {
                    <!-- Wallet Balance -->
                    <div class="wallet-balance" onclick="window.location.href='@Url.Action("Index", "Wallet")'">
                        <i class="bi bi-wallet-fill"></i> <span>@currentUser.WalletBalance.ToString("N0")₫</span>
                    </div>

                    <!-- User Avatar Dropdown -->
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-avatar">
                            @{
                                var nameParts = currentUser.FullName?.Split(' ');
                                var initials = "";
                                if (nameParts != null && nameParts.Length > 0)
                                {
                                    if (nameParts.Length >= 2)
                                    {
                                        initials = nameParts[0][0].ToString().ToUpper() + nameParts[nameParts.Length - 1][0].ToString().ToUpper();
                                    }
                                    else
                                    {
                                        initials = nameParts[0][0].ToString().ToUpper();
                                    }
                                }
                            }
                            @initials
                        </div>
                        <div class="user-dropdown-menu">
                            <!-- User Info -->
                            <div class="user-dropdown-header">
                                <div class="user-dropdown-name">@currentUser.FullName</div>
                                <div class="user-dropdown-email">@currentUser.Email</div>
                            </div>
                            <!-- Menu Items -->
                            <a href="@Url.Action("Index", "UserProfile")" class="user-dropdown-item">
                                <span class="dropdown-item-icon"><i class="bi bi-person-circle"></i></span>
                                <span>Thông tin cá nhân</span>
                            </a>
                            <a href="@Url.Action("Index", "History")" class="user-dropdown-item">
                                <span class="dropdown-item-icon"><i class="bi bi-clock-history"></i></span>
                                <span>Lịch sử giao dịch</span>
                            </a>
                            <a href="@Url.Action("Index", "Settings")" class="user-dropdown-item">
                                <span class="dropdown-item-icon"><i class="bi bi-gear-fill"></i></span>
                                <span>Cài đặt</span>
                            </a>
                            <a href="@Url.Action("Signout", "Login")" class="user-dropdown-item danger">
                                <span class="dropdown-item-icon"><i class="bi bi-box-arrow-right"></i></span>
                                <span>Đăng xuất</span>
                            </a>
                        </div>
                    </div>
                }
                else
                {
                    <a href="/Login/SignIn" class="btn-signin" style="text-decoration: none; background: var(--primary); color: white; padding: 8px 20px; border-radius: 10px; font-weight: 600;">
                        Đăng nhập
                    </a>
                }
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobileNav">
        <!-- Mobile Nav Header -->
        <div class="mobile-nav-header">
            <div class="logo">
                <div class="logo-icon" style="width: 36px; height: 36px; font-size: 18px;"><i class="bi bi-trophy-fill"></i></div>
                <span style="font-size: 18px;">SportHub</span>
            </div>
            <button class="mobile-nav-close" id="mobileNavClose">✕</button>
        </div>

        <!-- Mobile Nav Links -->
        <div class="mobile-nav-links">
            <!-- Main Menu -->
            <div class="mobile-nav-section">
                <div class="mobile-nav-section-title">Menu Chính</div>
                <a href="@Url.Action("Index", "Home")" class="mobile-nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" ? "active" : "")">
                    <span><i class="bi bi-house-door-fill"></i></span>
                    <span>Trang chủ</span>
                </a>
                <a href="@Url.Action("Index", "Booking")" class="mobile-nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Fields" ? "active" : "")">
                    <span><i class="bi bi-calendar-event-fill"></i></span>
                    <span>Đặt sân</span>
                </a>
            </div>

            <div class="mobile-nav-divider"></div>

            <!-- Services -->
            <div class="mobile-nav-section">
                <div class="mobile-nav-section-title">Dịch Vụ</div>
                <a href="@Url.Action("Index", "Food")" class="mobile-nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "FoodDrinks" ? "active" : "")">
                    <span><i class="bi bi-cup-hot-fill"></i></span>
                    <span>Đồ ăn & thức uống</span>
                </a>
                <a href="@Url.Action("Index", "Supplies")" class="mobile-nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Products" ? "active" : "")">
                    <span><i class="bi bi-bag-fill"></i></span>
                    <span>Đồ dùng thể thao</span>
                </a>
            </div>

            <div class="mobile-nav-divider"></div>

            @if (User.Identity.IsAuthenticated && currentUser != null)
            {
                <!-- Wallet -->
                <div class="mobile-nav-section">
                    <div class="mobile-nav-section-title">Tài Khoản</div>
                    <a href="@Url.Action("Index", "Wallet")" class="mobile-nav-link">
                        <span><i class="bi bi-wallet-fill"></i></span>
                        <span>Ví điện tử (@currentUser.WalletBalance.ToString("N0")₫)</span>
                    </a>
                    <a href="@Url.Action("index", "UserProfile")" class="mobile-nav-link">
                        <span><i class="bi bi-person-circle"></i></span>
                        <span>Thông tin cá nhân (@currentUser.FullName)</span>
                    </a>
                    <a href="@Url.Action("Index", "History")" class="mobile-nav-link">
                        <span><i class="bi bi-clock-history"></i></span>
                        <span>Lịch sử giao dịch</span>
                    </a>
                </div>
            }
            else
            {
                 <div class="mobile-nav-section">
                    <a href="/Login/SignIn" class="mobile-nav-link">
                        <span><i class="bi bi-box-arrow-in-right"></i></span>
                        <span>Đăng nhập</span>
                    </a>
                </div>
            }

            <div class="mobile-nav-divider"></div>

            <!-- Logout -->
            <a href="@Url.Action("Signout", "Login")" class="mobile-nav-link" style="color: var(--danger);">
                <span><i class="bi bi-box-arrow-right"></i></span>
                <span>Đăng xuất</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <!-- Brand Column -->
            <div class="footer-brand">
                <div class="footer-logo">
                    <img src="~/asset/img/logo.png" alt="SportHub Logo" class="logo-icon" />
                    <span>TQTSport</span>
                </div>
                <p class="footer-desc">
                    Nền tảng đặt sân thể thao trực tuyến hàng đầu Việt Nam.
                    Đặt sân dễ dàng, thanh toán nhanh chóng, trải nghiệm tuyệt vời.
                </p>
            </div>

            <!-- Products Column -->
            <div class="footer-column">
                <h4>Sản phẩm</h4>
                <div class="footer-links">
                    <a href="@Url.Action("Index", "Booking")" class="footer-link">Đặt sân bóng</a>
                    <a href="@Url.Action("Index", "Wallet")" class="footer-link">Ví điện tử</a>
                    <a href="@Url.Action("Index", "Food")" class="footer-link">Đồ ăn & thức uống</a>
                    <a href="@Url.Action("Index", "Products")" class="footer-link">Đồ dùng thể thao</a>
                </div>
            </div>

            <!-- Support Column -->
            <div class="footer-column">
                <h4>Hỗ trợ</h4>
                <div class="footer-links">
                    <a href="@Url.Action("Help", "Support")" class="footer-link">Trung tâm trợ giúp</a>
                    <a href="@Url.Action("Contact", "Support")" class="footer-link">Liên hệ</a>
                    <a href="@Url.Action("Terms", "Legal")" class="footer-link">Điều khoản</a>
                    <a href="@Url.Action("Privacy", "Legal")" class="footer-link">Chính sách</a>
                </div>
            </div>

            <!-- Social Column -->
            <div class="footer-column">
                <h4>Kết nối</h4>
                <div class="footer-links">
                    <a href="#" class="footer-link" target="_blank">Facebook</a>
                    <a href="#" class="footer-link" target="_blank">Instagram</a>
                    <a href="#" class="footer-link" target="_blank">Twitter</a>
                    <a href="#" class="footer-link" target="_blank">YouTube</a>
                </div>
            </div>
        </div>

        <!-- Footer Bottom -->
        <div class="footer-bottom">
            © @DateTime.Now.Year SportHub. All rights reserved. Made for football lovers.
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3"
         style="z-index: 9999; min-width: 300px;" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3"
         style="z-index: 9999; min-width: 300px;" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<script>
    // Auto dismiss sau 5 giây
    setTimeout(function() {
        var alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            var bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);
</script>
</html>

