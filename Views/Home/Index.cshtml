@using SportBookingSystem.Models.ViewModels
@model HomeViewModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles {
    <link rel="stylesheet" href="~/css/Home.css" />
}

<!-- Hero Section -->
<section class="hero">
    <div class="hero-background">
        <img src="~/asset/img/hero-section-pic.png" class="hero-pic">
    </div>
    <div class="hero-content">
        <h1>Đặt Sân Bóng<br>Dễ Dàng & Nhanh Chóng</h1>
        <p>Hệ thống đặt sân thể thao trực tuyến hiện đại với thanh toán ví điện tử tiện lợi</p>
        <div class="hero-actions">
            <a href="#fields" class="btn btn-primary"><i class="bi bi-calendar-check-fill"></i> Đặt sân ngay</a>
            <a href="#features" class="btn btn-secondary"><i class="bi bi-info-circle-fill"></i> Tìm hiểu thêm</a>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container">
    <!-- Wallet & Quick Actions -->
    <div class="wallet-section fade-in-up">
        <div class="wallet-card">
            <div class="wallet-header">
                <div>
                    <div class="wallet-title">Ví Điện Tử</div>
                </div>
                <div class="wallet-icon"><i class="bi bi-wallet-fill"></i></div>
            </div>

            <div class="wallet-balance-display">
                <div class="balance-label">Số dư khả dụng</div>
                <div class="balance-amount">@Model.User.WalletBalance.ToString("N0")₫</div>
            </div>

            <div class="wallet-actions">
                <button class="wallet-btn" data-bs-toggle="modal" data-bs-target="#topupModal">
                    <i class="bi bi-plus-circle-fill"></i> Nạp tiền
                </button>
                <button class="wallet-btn " data-bs-toggle="modal" data-bs-target="#transferMoneyModal">
                    <i class="bi bi-cash-coin"></i> Chuyển khoản
                </button>                 
                <button class="wallet-btn" onclick="window.location.href='@Url.Action("Index", "Wallet")'"><i class="bi bi-graph-up-arrow"></i> Chi tiết</button>
            </div>
        </div>


      

        <div class="quick-actions">
            <h3 class="quick-actions-title">Thao tác nhanh</h3>
            <div class="action-list">
                <a href="@Url.Action("Index", "History")" class="action-item">
                    <div class="action-icon"><i class="bi bi-calendar-event-fill"></i></div>
                    <div class="action-text">
                        <div class="action-title">Lịch đặt sân của tôi</div>
                        <div class="action-desc">@Model.UpcomingBookingsCount lịch sắp tới</div>
                    </div>
                    <span>→</span>
                </a>

                <a href="#" class="action-item">
                    <div class="action-icon"><i class="bi bi-gift-fill"></i></div>
                    <div class="action-text">
                        <div class="action-title">Điểm thưởng</div>
                        <div class="action-desc">@Model.User.RewardPoints.ToString("N0") điểm</div>
                    </div>
                    <span>→</span>
                </a>

                <a href="@Url.Action("Index", "UserProfile")" class="action-item">
                    <div class="action-icon"><i class="bi bi-gear-fill"></i></div>
                    <div class="action-text">
                        <div class="action-title">Cài đặt</div>
                        <div class="action-desc">Quản lý tài khoản</div>
                    </div>
                    <span>→</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Fields Section -->
    <section id="fields" class="fade-in-up delay-1">
        <div class="section-header">
            <div class="section-header-content">
                <h2 class="section-title"><i class="bi bi-trophy-fill"></i> Chọn Sân Yêu Thích</h2>
                <p class="section-subtitle">Đa dạng loại sân, giá cả hợp lý, đặt sân dễ dàng</p>
            </div>
            <a href="@Url.Action("Index", "Fields")" class="view-all-btn">
                Xem tất cả →
            </a>
        </div>
        <div class="fields-grid">
            <!-- Field Card 1 -->
            <div class="field-card">
                <div class="field-image">
                    <span class="field-badge"><i class="bi bi-star-fill"></i> Phổ biến</span>
                </div>
                <div class="field-content">
                    <div class="field-header">
                        <div>
                            <div class="field-name">Sân A1 - Premium</div>
                            <div class="field-type">Sân 5 người</div>
                        </div>
                    </div>

                    <div class="field-footer">
                        <div class="field-price">
                            <span class="price-label">Giá từ</span>
                            <span class="price-value">300K/h</span>
                        </div>
                        <button class="btn-book">Đặt sân</button>
                    </div>
                </div>
            </div>

            <!-- Field Card 2 -->
            <div class="field-card">
                <div class="field-image" style="background: linear-gradient(135deg, #F59E0B, #EF4444);">
                    <span class="field-badge"><i class="bi bi-fire"></i> Hot</span>
                </div>
                <div class="field-content">
                    <div class="field-header">
                        <div>
                            <div class="field-name">Sân B3 - Standard</div>
                            <div class="field-type">Sân 7 người</div>
                        </div>
                    </div>

                    <div class="field-footer">
                        <div class="field-price">
                            <span class="price-label">Giá từ</span>
                            <span class="price-value">450K/h</span>
                        </div>
                        <button class="btn-book">Đặt sân</button>
                    </div>
                </div>
            </div>

            <!-- Field Card 3 -->
            <div class="field-card">
                <div class="field-image" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">
                    <span class="field-badge"><i class="bi bi-gem"></i> VIP</span>
                </div>
                <div class="field-content">
                    <div class="field-header">
                        <div>
                            <div class="field-name">Sân C2 - Deluxe</div>
                            <div class="field-type">Sân 11 người</div>
                        </div>
                    </div>

                    <div class="field-footer">
                        <div class="field-price">
                            <span class="price-label">Giá từ</span>
                            <span class="price-value">800K/h</span>
                        </div>
                        <button class="btn-book">Đặt sân</button>
                    </div>
                </div>
            </div>

            <!-- Field Card 4 -->
            <div class="field-card">
                <div class="field-image" style="background: linear-gradient(135deg, #06B6D4, #3B82F6);">
                    <span class="field-badge"><i class="bi bi-cash-coin"></i> Giá tốt</span>
                </div>
                <div class="field-content">
                    <div class="field-header">
                        <div>
                            <div class="field-name">Sân A3 - Economy</div>
                            <div class="field-type">Sân 5 người</div>
                        </div>
                    </div>

                    <div class="field-footer">
                        <div class="field-price">
                            <span class="price-label">Giá từ</span>
                            <span class="price-value">250K/h</span>
                        </div>
                        <button class="btn-book">Đặt sân</button>
                    </div>
                </div>
            </div>

            <!-- Field Card 5 -->
            <div class="field-card">
                <div class="field-image" style="background: linear-gradient(135deg, #14B8A6, #10B981);">
                    <span class="field-badge"><i class="bi bi-newspaper"></i> Mới</span>
                </div>
                <div class="field-content">
                    <div class="field-header">
                        <div>
                            <div class="field-name">Sân D1 - New</div>
                            <div class="field-type">Sân 7 người</div>
                        </div>
                    </div>

                    <div class="field-footer">
                        <div class="field-price">
                            <span class="price-label">Giá từ</span>
                            <span class="price-value">400K/h</span>
                        </div>
                        <button class="btn-book">Đặt sân</button>
                    </div>
                </div>
            </div>

            <!-- Field Card 6 -->
            <div class="field-card">
                <div class="field-image" style="background: linear-gradient(135deg, #F59E0B, #10B981);">
                    <span class="field-badge"><i class="bi bi-star-fill"></i> Top rated</span>
                </div>
                <div class="field-content">
                    <div class="field-header">
                        <div>
                            <div class="field-name">Sân B1 - Premium</div>
                            <div class="field-type">Sân 5 người</div>
                        </div>
                    </div>

                    <div class="field-footer">
                        <div class="field-price">
                            <span class="price-label">Giá từ</span>
                            <span class="price-value">350K/h</span>
                        </div>
                        <button class="btn-book">Đặt sân</button>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- ĐỒ ĂN & THỨC UỐNG NỔI BẬT -->
    <section id="food-drinks" class="products-section fade-in-up delay-2">
        <div class="section-header">
            <div class="section-header-content">
                <h2 class="section-title"><i class="bi bi-cup-hot-fill"></i> Đồ Ăn & Thức Uống Nổi Bật</h2>
                <p class="section-subtitle">Gọi món giao tận sân, không lo gián đoạn trận đấu</p>
            </div>
            <a href="@Url.Action("Index", "FoodDrinks")" class="view-all-btn">
                Xem tất cả →
            </a>
        </div>

        <div class="products-grid">
            <!-- Food Item 1 -->
            <div class="product-card">
                <div class="product-image food-bg-1">
                    <span class="product-badge hot"><i class="bi bi-fire"></i> Bán chạy</span>
                    <div class="product-emoji"><i class="bi bi-cup-hot-fill"></i></div>
                </div>
                <div class="product-content">
                    <div class="product-header">
                        <h3 class="product-name">Combo Burger Bò</h3>
                    </div>
                    <p class="product-desc">Burger bò + Khoai tây + Coca</p>

                    <div class="product-footer">
                        <div class="product-price">
                            <span class="price-label">Giá</span>
                            <span class="price-value">85K</span>
                        </div>
                        <div class="product-actions">
                            <button class="btn-add-cart">
                                <i class="bi bi-cart-plus-fill"></i> Giỏ hàng
                            </button>
                            <button class="btn-buy-now">
                                <i class="bi bi-credit-card-fill"></i> Mua ngay
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Food Item 2 -->
            <div class="product-card">
                <div class="product-image food-bg-2">
                    <span class="product-badge new"><i class="bi bi-newspaper"></i> Mới</span>
                    <div class="product-emoji"><i class="bi bi-pie-chart-fill"></i></div>
                </div>
                <div class="product-content">
                    <div class="product-header">
                        <h3 class="product-name">Pizza Hải Sản</h3>
                    </div>
                    <p class="product-desc">Pizza size M, đế dày, nhiều topping</p>

                    <div class="product-footer">
                        <div class="product-price">
                            <span class="price-label">Giá</span>
                            <span class="price-value">120K</span>
                        </div>
                        <div class="product-actions">
                            <button class="btn-add-cart">
                                <i class="bi bi-cart-plus-fill"></i> Giỏ hàng
                            </button>
                            <button class="btn-buy-now">
                                <i class="bi bi-credit-card-fill"></i> Mua ngay
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Food Item 3 -->
            <div class="product-card">
                <div class="product-image food-bg-3">
                    <span class="product-badge discount"><i class="bi bi-cash-coin"></i> Giảm giá</span>
                    <div class="product-emoji"><i class="bi bi-cup-straw"></i></div>
                </div>
                <div class="product-content">
                    <div class="product-header">
                        <h3 class="product-name">Trà Sữa Trân Châu</h3>
                    </div>
                    <p class="product-desc">Trà sữa size L, ít đường, nhiều topping</p>

                    <div class="product-footer">
                        <div class="product-price">
                            <span class="price-label">Giá</span>
                            <span class="price-value">35K</span>
                        </div>
                        <div class="product-actions">
                            <button class="btn-add-cart">
                                <i class="bi bi-cart-plus-fill"></i> Giỏ hàng
                            </button>
                            <button class="btn-buy-now">
                                <i class="bi bi-cart-plus-fill"></i> Mua ngay
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ĐỒ DÙNG THỂ THAO NỔI BẬT -->
    <section id="products" class="products-section fade-in-up delay-3">
        <div class="section-header">
            <div class="section-header-content">
                <h2 class="section-title"><i class="bi bi-trophy-fill"></i> Đồ Dùng Thể Thao Nổi Bật</h2>
                <p class="section-subtitle">Trang bị chuyên nghiệp cho người chơi</p>
            </div>
            <a href="@Url.Action("Index", "Products")" class="view-all-btn">
                Xem tất cả →
            </a>
        </div>

        <div class="products-grid">
            <!-- Product Item 1 -->
            <div class="product-card">
                <div class="product-image product-bg-1">
                    <span class="product-badge hot"><i class="bi bi-fire"></i> Hot</span>
                    <div class="product-emoji"><i class="bi bi-tag-fill"></i></div>
                </div>
                <div class="product-content">
                    <div class="product-header">
                        <h3 class="product-name">Giày Đá Bóng Nike</h3>
                    </div>
                    <p class="product-desc">Nike Mercurial Vapor 14, màu đen</p>

                    <div class="product-footer">
                        <div class="product-price">
                            <span class="price-label">Giá</span>
                            <span class="price-value">1.2 Tr</span>
                        </div>
                        <button class="btn-rent-now">
                            <i class="bi bi-bag-check-fill"></i> Thuê ngay
                        </button>
                    </div>
                </div>
            </div>

            <!-- Product Item 2 -->
            <div class="product-card">
                <div class="product-image product-bg-2">
                    <span class="product-badge popular"><i class="bi bi-star-fill"></i> Phổ biến</span>
                    <div class="product-emoji"><i class="bi bi-bag-fill"></i></div>
                </div>
                <div class="product-content">
                    <div class="product-header">
                        <h3 class="product-name">Áo Đá Bóng Adidas</h3>
                    </div>
                    <p class="product-desc">Áo thể thao co giãn 4 chiều, thoáng mát</p>

                    <div class="product-footer">
                        <div class="product-price">
                            <span class="price-label">Giá</span>
                            <span class="price-value">250K</span>
                        </div>
                        <button class="btn-rent-now">
                            <i class="bi bi-bag-check-fill"></i> Thuê ngay
                        </button>
                    </div>
                </div>
            </div>

            <!-- Product Item 3 -->
            <div class="product-card">
                <div class="product-image product-bg-3">
                    <span class="product-badge new"><i class="bi bi-newspaper"></i> Mới về</span>
                    <div class="product-emoji"><i class="bi bi-shield-fill"></i></div>
                </div>
                <div class="product-content">
                    <div class="product-header">
                        <h3 class="product-name">Găng Tay Thủ Môn</h3>
                    </div>
                    <p class="product-desc">Găng tay bắt bóng chống trượt, có khung bảo vệ</p>

                    <div class="product-footer">
                        <div class="product-price">
                            <span class="price-label">Giá</span>
                            <span class="price-value">350K</span>
                        </div>
                        <button class="btn-rent-now">
                            <i class="bi bi-bag-check-fill"></i> Thuê ngay
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- History Section -->
    <section id="history" class="history-card fade-in-up delay-3">
        <div class="history-header">
            <h2 class="history-title"><i class="bi bi-clock-history"></i> Lịch Sử Giao Dịch Gần Đây</h2>
            <button class="btn btn-secondary" onclick="window.location.href='@Url.Action("Index", "History")'">Xem tất cả</button>
        </div>

        <div class="history-list">
            @if (Model.RecentTransactions != null && Model.RecentTransactions.Any())
            {
                foreach (var transaction in Model.RecentTransactions)
                {
                    var isNegative = transaction.UserId == Model.User.UserId && transaction.ReceiverId != null && transaction.ReceiverId != Model.User.UserId;
                    var amountClass = isNegative ? "negative" : "positive";
                    var amountPrefix = isNegative ? "-" : "+";
                    
                    var iconClass = "bi-cash-coin";
                    if (transaction.TransactionType?.Contains("Sân") == true || transaction.Message?.Contains("Đặt sân") == true) iconClass = "bi-building";
                    else if (transaction.TransactionType?.Contains("Thức ăn") == true || transaction.Message?.Contains("Canteen") == true) iconClass = "bi-cup-hot-fill";

                    <div class="history-item">
                        <div class="history-icon"><i class="bi @iconClass"></i></div>
                        <div class="history-details">
                            <div class="history-item-title">@transaction.Message</div>
                            <div class="history-item-date">@transaction.TransactionDate.ToString("dd/MM/yyyy HH:mm")</div>
                        </div>
                        <div class="history-amount @amountClass">@amountPrefix@transaction.Amount.ToString("N0")₫</div>
                        <span class="history-status success">Hoàn thành</span>
                    </div>
                }
            }
            else
            {
                <div class="history-empty" style="text-align: center; padding: 40px; color: var(--text-muted);">
                    <i class="bi bi-inbox" style="font-size: 48px; display: block; margin-bottom: 10px;"></i>
                    <p>Chưa có giao dịch nào gần đây</p>
                </div>
            }
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="features-section fade-in-up delay-2">
        <div class="section-header" style="text-align: center;">
            <h2 class="section-title"><i class="bi bi-gem"></i> Tại Sao Chọn SportHub?</h2>
            <p class="section-subtitle">Trải nghiệm đặt sân hiện đại với nhiều tiện ích vượt trội</p>
        </div>

        <div class="features-grid">
            <div class="feature-item">
                <div class="feature-icon"><i class="bi bi-lightning-fill"></i></div>
                <h3 class="feature-title">Đặt Sân Nhanh Chóng</h3>
                <p class="feature-desc">Chỉ 3 bước đơn giản, đặt sân trong vòng 30 giây</p>
            </div>

            <div class="feature-item">
                <div class="feature-icon"><i class="bi bi-credit-card-fill"></i></div>
                <h3 class="feature-title">Thanh Toán Linh Hoạt</h3>
                <p class="feature-desc">Ví điện tử, chuyển khoản, thẻ tín dụng - đa dạng phương thức</p>
            </div>

            <div class="feature-item">
                <div class="feature-icon"><i class="bi bi-gift-fill"></i></div>
                <h3 class="feature-title">Tích Điểm Thưởng</h3>
                <p class="feature-desc">Tích điểm mỗi lần đặt sân, đổi quà hấp dẫn</p>
            </div>

            <div class="feature-item">
                <div class="feature-icon"><i class="bi bi-cup-hot-fill"></i></div>
                <h3 class="feature-title">Canteen Tiện Lợi</h3>
                <p class="feature-desc">Đặt đồ ăn uống giao tận sân, không lo gián đoạn</p>
            </div>
        </div>
    </section>
</div>
<div class="modal fade" id="topupModal" tabindex="-1" aria-labelledby="topupModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 20px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <div class="modal-header border-0 pt-4 px-4">
                <h5 class="modal-title fw-bold" id="topupModalLabel">
                    <i class="bi bi-plus-circle-fill text-primary me-2"></i>Nạp Tiền Vào Ví
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <form id="topupForm">
                    <label class="form-label small text-muted mb-3">Chọn số tiền muốn nạp</label>
                    <div class="row g-2 mb-3">
                        <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 py-2 btn-amount" data-amount="50000">50K</button></div>
                        <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 py-2 btn-amount" data-amount="100000">100K</button></div>
                        <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 py-2 btn-amount" data-amount="200000">200K</button></div>
                    </div>

                    <input type="number" class="form-control form-control-lg mb-4" id="topupAmount"
                           placeholder="Hoặc nhập số tiền khác" min="10000" style="border-radius: 12px; background: #f8f9fa;">

                    <label class="form-label small text-muted mb-2">Phương thức thanh toán</label>
                    <div class="payment-option p-3 mb-4 d-flex align-items-center border rounded-3 active" style="cursor: pointer;">
                        <input class="form-check-input me-3" type="radio" name="paymentMethod" checked>
                        <img src="https://vinadesign.vn/uploads/images/2023/05/vnpay-logo-vinadesign-25-12-57-55.jpg" width="30" class="me-2">
                        <span class="small fw-bold">Cổng thanh toán VNPay</span>
                    </div>

                    <button type="button" class="btn btn-success w-100 py-3 fw-bold shadow-sm"
                            onclick="processTopup()" style="border-radius: 12px;">
                        <i class="bi bi-shield-check me-2"></i>Tiến hành nạp tiền
                    </button>
                </form>
            </div>
        </div>
    </div>

</div>
@* //modal chuyển khoản *@

<div class="modal fade" id="transferMoneyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-white text-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold"><i class="bi bi-send-fill me-2"></i>Chuyển tiền nội bộ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-bold">Số điện thoại người nhận</label>
                    <input type="text" id="trf_phone" class="form-control" placeholder="Nhập SĐT người nhận...">
                    <div id="trf_receiver_name" class="mt-1 small text-primary fw-bold" style="display:none"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Số tiền muốn chuyển</label>
                    <input type="number" id="trf_amount" class="form-control" placeholder="0">
                    <div class="mt-1 small text-muted">Số dư hiện tại: <span class="fw-bold">@Model.User.WalletBalance.ToString("N0")₫</span></div>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Lời nhắn</label>
                    <textarea id="trf_message" class="form-control" rows="2" placeholder="Nhập nội dung..."></textarea>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Hủy</button>
                <button type="button" id="btn_confirm_transfer" class="btn btn-success px-4">Xác nhận chuyển</button>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="~/js/Home.js"></script>
}
@if (TempData["PaymentMessage"] != null)
{
    <script>
        Swal.fire({
            title: '@(TempData["PaymentStatus"]?.ToString() == "success" ? "Thành công!" : "Thất bại!")',
            html: '@Html.Raw(TempData["PaymentMessage"])',
            icon: '@TempData["PaymentStatus"]',
            confirmButtonText: 'Đồng ý',
            confirmButtonColor: '#28a745'
        });
    </script>
}