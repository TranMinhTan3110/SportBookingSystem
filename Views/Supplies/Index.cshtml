@{
    ViewData["Title"] = "Đồ dùng thể thao";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles{
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    @* <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"> *@

    <link href="~/css/Supplies.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
}
<section class="banner">
    <div class="breadcrumb">
        <a href="/">Trang chủ</a>
        <span class="separator">›</span>
        <a href="/dich-vu">Dịch vụ</a>
        <span class="separator">›</span>
        <span class="current">Dụng cụ thể thao</span>
    </div>
    <div class="banner-content">
        <h1>Chào mừng đến với đồ dùng thể thao</h1>
        <p>Nơi cung cấp đầy đủ dụng cụ thể thao cho mọi nhu cầu của bạn!</p>
    </div>
</section>
<section class="main-content">
    <div class="container-fluid py-4">
        <div class="row g-4">
            <!-- Bộ Lọc - 3 cột -->
            <div class="col-lg-3 col-md-4 col-12">
                <div class="filter-sidebar">
                    <h4 class="filter-title">Bộ Lọc</h4>

                    <!-- Search Bar -->
                    <div class="filter-group">
                        <h5>Tìm kiếm</h5>
                        <input type="text" id="userSearchInput" class="form-control" placeholder="Tên sản phẩm, thương hiệu...">
                    </div>

                    <!-- Danh mục (Dynamic) -->
                    <div class="filter-group">
                        <h5>Danh mục</h5>
                        <div id="categoryFilters">
                           <p class="text-muted">Đang tải...</p>
                        </div>
                    </div>

                    <!-- Khoảng giá -->
                    <div class="filter-group">
                        <h5>Khoảng giá</h5>
                        <div class="price-range">
                            <input type="number" id="minPrice" placeholder="Từ" min="0">
                            <span>-</span>
                            <input type="number" id="maxPrice" placeholder="Đến" min="0">
                        </div>
                    </div>

                    <!-- Thương hiệu (Dynamic) -->
                    <div class="filter-group">
                        <h5>Thương hiệu</h5>
                        <div id="brandFilters">
                            <p class="text-muted">Đang tải...</p>
                        </div>
                    </div>

                    <button class="btn-apply-filter" onclick="applyFilters()">Áp dụng</button>
                    <button class="btn-reset-filter" onclick="resetFilters()">Xóa bộ lọc</button>
                </div>
            </div>

            <!-- Sản phẩm - 9 cột -->
            <div class="col-lg-9 col-md-8 col-12">
                <div class="products-section">
                    <!-- Header -->
                    <div class="products-header">
                        <div class="products-count" id="productsCount">
                            Đang tải sản phẩm...
                        </div>
                        <div class="sort-dropdown">
                            <select id="sortBy" onchange="applyFilters()">
                                <option value="newest">Sắp xếp: Mới nhất</option>
                                <option value="price_asc">Giá: Thấp đến cao</option>
                                <option value="price_desc">Giá: Cao đến thấp</option>
                                <option value="name_asc">Tên: A-Z</option>
                            </select>
                        </div>
                    </div>

                    <div class="products-grid" id="productsGrid">
                       
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Purchase Modal -->
<div class="modal fade" id="purchaseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 20px; overflow: hidden;">
            <div class="modal-header bg-primary text-white py-3">
                <h5 class="modal-title fw-bold"><i class="fa-solid fa-cart-shopping me-2"></i>Thanh toán sản phẩm</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="d-flex align-items-center mb-4 p-3 bg-light rounded-3">
                    <img id="modalProductImage" src="" alt="" class="rounded-3 me-3" style="width: 80px; height: 80px; object-fit: cover; border: 2px solid #fff;">
                    <div>
                        <h6 id="modalProductName" class="fw-bold mb-1" style="font-size: 1.1rem;"></h6>
                        <p id="modalProductPrice" class="text-primary fw-bold mb-0"></p>
                    </div>
                </div>
                
                <div class="bg-light p-3 rounded-3 mb-4">
                    <label class="form-label fw-bold mb-2">Số lượng mua</label>
                    <div class="input-group">
                        <button class="btn btn-outline-primary px-3" onclick="updateQuantity(-1)">-</button>
                        <input type="number" id="purchaseQuantity" class="form-control text-center fw-bold border-primary" value="1" min="1" readonly>
                        <button class="btn btn-outline-primary px-3" onclick="updateQuantity(1)">+</button>
                    </div>
                    <div class="mt-3 d-flex justify-content-between align-items-center">
                        <span class="text-muted">Tổng cộng:</span>
                        <h4 id="modalTotalPrice" class="text-danger fw-bold mb-0">0₫</h4>
                    </div>
                </div>

                <div class="alert alert-info border-0 mb-0" style="background-color: #e3f2fd; color: #0d47a1;">
                    <i class="fa-solid fa-circle-info me-2"></i> Số dư sẽ được trừ trực tiếp vào ví sau khi nhấn thanh toán.
                </div>
            </div>
            <div class="modal-footer border-0 p-4 pt-0">
                <button type="button" class="btn btn-light px-4 py-2 fw-semibold" data-bs-dismiss="modal" style="border-radius: 10px;">Hủy bỏ</button>
                <button type="button" class="btn btn-primary px-5 py-2 fw-semibold shadow-sm" onclick="confirmPayment()" style="border-radius: 10px;">Xác nhận thanh toán</button>
            </div>
        </div>
    </div>
</div>

<!-- QR Success Modal -->   
<div class="modal fade" id="qrModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
            <div class="modal-body text-center p-5">
                <div class="mb-4">
                    <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 70px; height: 70px;">
                        <i class="fa-solid fa-check fa-2xl"></i>
                    </div>
                    <h3 class="fw-bold text-success">Thanh toán thành công!</h3>
                    <p class="text-muted">Vui lòng lưu lại mã QR dưới đây và đưa cho nhân viên tại sân để nhận đồ.</p>
                </div>
                
                 <div class="qr-container p-3 bg-white border rounded-4 mb-4 shadow-sm">
                    <img id="purchaseQrCode" src="" alt="QR Code" class="img-fluid" style="max-width: 250px;">
                    <div id="suppliesQrCountdown" class="mt-3 fw-bold text-danger" style="font-size: 1.1rem;">
                        Hết hạn sau: <span id="suppliesTimer">15:00</span>
                    </div>
                </div>

                <button type="button" class="btn btn-primary w-100 py-3 fw-bold" onclick="location.reload()" style="border-radius: 15px;">Đã hiểu, Quay lại</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/supplies.js"></script>
}
