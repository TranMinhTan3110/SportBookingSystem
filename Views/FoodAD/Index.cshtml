@{
    ViewData["Title"] = "Quản Lý Đồ Ăn";
    Layout = "~/Views/Shared/LayoutAdmin.cshtml";
}
@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="~/asset/css/foodAD.css" />
}

<!-- Page Content -->
<div class="page-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">Quản lý Đồ Ăn VÀ Thức Uống</h1>
        <button class="btn-add" onclick="openModal('add')">
            <span>Thêm Sản Phẩm Mới</span>
        </button>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="filter-grid">
            <div class="form-group">
                <label class="form-label">TÌM KIẾM</label>
                <input type="text" class="form-control" id="searchInput" placeholder="Tìm theo tên sản phẩm...">
            </div>
            <div class="form-group">
                <label class="form-label">LOẠI SẢN PHẨM</label>
                <select class="form-select" id="filterType">
                    <option value="">Tất cả</option>
                    @foreach (var category in ViewBag.Categories)
                    {
                        <option value="@category.CategoryId">@category.CategoryName</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">TÌNH TRẠNG KHO</label>
                <select class="form-select" id="filterStock">
                    <option value="">Tất cả</option>
                    <option value="in">Còn hàng</option>
                    <option value="low">Sắp hết</option>
                    <option value="out">Hết hàng</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">HÀNH ĐỘNG</label>
                <button class="btn-refresh" onclick="refreshFilters()">
                    <i class="fa-solid fa-arrows-rotate"></i>
                    <span>Làm mới</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Table Section -->
    <div class="table-section">
        <div class="table-wrapper">
            <table class="product-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>HÌNH ẢNH</th>
                        <th>TÊN SẢN PHẨM</th>
                        <th>LOẠI</th>
                        <th>GIÁ BÁN</th>
                        <th>SỐ LƯỢNG</th>
                        <th>THAO TÁC</th>
                    </tr>
                </thead>
                <tbody id="productTableBody">
                    @foreach (var product in Model)
                    {
                        <tr data-category-id="@product.CategoryId" class="@(!product.Status ? "row-hidden" : "")">
                            <td>#@product.ProductId.ToString("D3")</td>
                            <td>
                                <img src="@(string.IsNullOrEmpty(product.ImageUrl) ? "https://via.placeholder.com/200" : product.ImageUrl)"
                                     alt="@product.ProductName" class="product-img @(!product.Status ? "img-grayscale" : "")">
                            </td>
                            <td>
                                <div class="product-name">@product.ProductName</div>
                                <div class="product-category">@product.CategoryName</div>
                                @if (!product.Status)
                                {
                                    <span class="status-badge status-hidden">
                                        <i class="fa-solid fa-eye-slash"></i> Đã ẩn
                                    </span>
                                }
                            </td>
                            <td>
                                <span class="badge @product.BadgeClass">@product.CategoryName</span>
                            </td>
                            <td>@product.Price.ToString("N0")₫</td>
                            <td>
                                <span class="stock-status @product.StockStatusClass">@product.StockStatusText</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action btn-view" onclick="addStockQuick(@product.ProductId)" title="Thêm số lượng">
                                        <i class="fa-solid fa-plus"></i>
                                    </button>
                                    <button class="btn-action btn-edit" onclick="openModal('edit', @product.ProductId)" title="Sửa">
                                        <i class="fa-solid fa-pen-to-square"></i>
                                    </button>
                                    <button class="btn-action @(product.Status ? "btn-hide" : "btn-show")"
                                            onclick="toggleProductStatus(@product.ProductId, @product.Status.ToString().ToLower())"
                                            title="@(product.Status ? "Ẩn sản phẩm" : "Hiện sản phẩm")">
                                        <i class="fa-solid @(product.Status ? "fa-eye-slash" : "fa-eye")"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="pagination-container">
            <div class="pagination-info">
                <span id="paginationInfo">Hiển thị <strong>1-10</strong> của <strong>0</strong> sản phẩm</span>
            </div>
            <div class="pagination-controls">
                <button class="pagination-btn" id="firstPage" onclick="goToFirstPage()" title="Trang đầu">
                    <i class="fa-solid fa-angles-left"></i>
                </button>
                <button class="pagination-btn" id="prevPage" onclick="goToPrevPage()" title="Trang trước">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <div class="pagination-pages" id="paginationPages">
                </div>
                <button class="pagination-btn" id="nextPage" onclick="goToNextPage()" title="Trang sau">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
                <button class="pagination-btn" id="lastPage" onclick="goToLastPage()" title="Trang cuối">
                    <i class="fa-solid fa-angles-right"></i>
                </button>
            </div>
        </div>
    </div>

<div class="modal-overlay" id="productModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Thêm Sản Phẩm Mới</h3>
            <button class="btn-close" onclick="closeModal()">X</button>
        </div>
        <div class="modal-body">
            <form id="productForm">
                <div class="form-group">
                    <label class="form-label">TÊN SẢN PHẨM *</label>
                    <input type="text" class="form-control" id="productName" placeholder="Nhập tên sản phẩm..." required>
                </div>

                <div class="form-group">
                    <label class="form-label">LOẠI SẢN PHẨM *</label>
                    <select class="form-select" id="productCategory" required>
                        <option value="">Chọn loại sản phẩm</option>
                        @foreach (var category in ViewBag.Categories)
                        {
                            <option value="@category.CategoryId">@category.CategoryName</option>
                        }
                    </select>
                </div>

                <div class="filter-grid">
                    <div class="form-group">
                        <label class="form-label">GIÁ BÁN (VNĐ) *</label>
                        <input type="number" class="form-control" id="productPrice" placeholder="Nhập giá..." required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">SỐ LƯỢNG *</label>
                        <input type="number" class="form-control" id="productStock" placeholder="Nhập số lượng..." required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ĐƠN VỊ</label>
                    <input type="text" class="form-control" id="productUnit" placeholder="VD: Phần, Ly, Lon, Chai...">
                </div>

                <div class="form-group">
                    <label class="form-label">HÌNH ẢNH SẢN PHẨM</label>
                    <div class="image-upload-container">
                        <input type="file"
                               class="form-control-file"
                               id="productImageFile"
                               accept="image/*"
                               onchange="previewImage(event)">
                        <small class="upload-hint">
                            <i class="fa-solid fa-circle-info"></i>
                            JPG, PNG, GIF, WEBP - Tối đa 5MB
                        </small>
                        <div class="image-preview" id="imagePreview">
                            <img id="previewImg" src="~/asset/img/default-product.png" alt="Preview">
                            <button type="button" class="btn-remove-image" onclick="removeImage()">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                        <input type="hidden" id="productImage">
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeModal()">Hủy</button>
            <button class="btn-save" onclick="saveProduct()">Lưu</button>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="~/asset/js/foodAD.js"></script>
