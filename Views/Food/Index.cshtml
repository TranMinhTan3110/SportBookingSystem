@model SportBookingSystem.Models.ViewModels.FoodIndexViewModel
@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/asset/css/food.css" />
}
@{
    ViewData["Title"] = "Dặt đồ ăn";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<section class="banner">
    <div class="breadcrumb">
        <a href="/">Trang chủ</a>
        <span class="separator">›</span>
        <a href="/dich-vu">Dịch vụ</a>
        <span class="separator">›</span>
        <span class="current">Đồ ăn</span>
    </div>
    <div class="banner-content">
        <h1>Chào mừng đến với SportHub</h1>
        <p>Đặt ngay món ngon giao tận sân - Không lo gián đoạn trận đấu!</p>
    </div>
</section>
<div class="container-fluid py-4">
        <div class="row g-4">
            <div class="col-lg-3 col-md-4 col-12">
                <div class="filter-sidebar">
                    <h4 class="filter-title">Bộ Lọc</h4>

                    <div class="filter-group">
                        <h5>Danh mục</h5>
                        @foreach (var cat in Model.Categories)
                        {
                            <div class="filter-option">
                                <input type="checkbox" class="category-checkbox"
                                       id="cat-@cat.CategoryId" value="@cat.CategoryId">
                                <label for="cat-@cat.CategoryId">@cat.CategoryName (@cat.ProductCount)</label>
                            </div>
                        }
                    </div>

                    <div class="filter-group">
                        <h5>Khoảng giá</h5>
                        <div class="price-range">
                            <input type="number" placeholder="Từ" min="0">
                            <span>-</span>
                            <input type="number" placeholder="Đến" min="0">
                        </div>
                    </div>

                    <button class="btn-apply-filter">Áp dụng</button>
                    <button class="btn-reset-filter">Xóa bộ lọc</button>
                </div>
            </div>

            <div class="col-lg-9 col-md-8 col-12">
                <div class="products-section">
                    <div class="products-header">
                        <div class="products-count">
                            Hiển thị <strong>8</strong> / 156 sản phẩm
                        </div>
                        <div class="sort-dropdown">
                            <select>
                                <option>Sắp xếp: Mặc định</option>
                                <option>Giá: Thấp đến cao</option>
                                <option>Giá: Cao đến thấp</option>
                                <option>Tên: A-Z</option>
                                <option>Mới nhất</option>
                            </select>
                        </div>
                    </div>

                <div class="products-grid" id="productsList">
                    @foreach (var p in Model.Products)
                    {
                        <div class="product-card shadow-sm border-0" style="border-radius: 15px; overflow: hidden; transition: transform 0.3s;">
                            <div class="product-image position-relative">
                                <img src="@(string.IsNullOrEmpty(p.ImageUrl) ? "/asset/img/default-product.jpg" : p.ImageUrl)" alt="@p.ProductName" style="height: 200px; width: 100%; object-fit: cover;">
                                <span class="badge bg-primary position-absolute top-0 end-0 m-2 shadow-sm fs-6 px-2 py-1">@p.CategoryName</span>
                            </div>
                            <div class="product-info p-3">
                                <div class="product-name fw-bold mb-1" style="font-size: 1.1rem; height: 2.6rem; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">@p.ProductName</div>
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div class="product-price text-primary fw-bold fs-5">@p.FormattedPrice</div>
                                </div>
                                <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                                    <button class="btn btn-primary py-2 fw-semibold flex-fill" onclick="openPurchaseModal(@p.ProductId, '@p.ProductName.Replace("'", "\\'")', @p.Price, '@(string.IsNullOrEmpty(p.ImageUrl) ? "/asset/img/default-product.jpg" : p.ImageUrl)')" style="border-radius: 10px;">
                                        <i class="fa-solid fa-bag-shopping me-2"></i>Mua ngay
                                    </button>
                                    <button class="btn btn-outline-primary py-2 fw-semibold flex-fill" onclick="addToCart(@p.ProductId, '@p.ProductName.Replace("'", "\\'")', @p.Price)" style="border-radius: 10px;">
                                        <i class="fa-solid fa-cart-plus me-2"></i>Thêm vào giỏ
                                    </button>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Purchase Modal -->
    <div class="modal fade" id="purchaseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px; overflow: hidden;">
                <div class="modal-header bg-primary text-white py-3">
                    <h5 class="modal-title fw-bold"><i class="fa-solid fa-utensils me-2"></i>Đặt món ăn</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="d-flex align-items-center mb-4 p-3 bg-light rounded-3">
                        <img id="modalProductImage" src="" alt="" class="rounded-3 me-3" style="width: 80px; height: 80px; object-fit: cover; border: 2px solid #fff;">
                        <div>
                            <h6 id="modalProductName" class="fw-bold mb-1" style="font-size: 1.1rem;"></h6>
                            <p id="modalProductPrice" class="text-primary fw-bold mb-0"></p>
                        </div>
                    </div>
                    
                    <div class="bg-light p-3 rounded-3 mb-4">
                        <label class="form-label fw-bold mb-2">Số lượng</label>
                        <div class="input-group">
                            <button class="btn btn-outline-primary px-3" onclick="updateQuantity(-1)">-</button>
                            <input type="number" id="purchaseQuantity" class="form-control text-center fw-bold border-primary" value="1" min="1" readonly>
                            <button class="btn btn-outline-primary px-3" onclick="updateQuantity(1)">+</button>
                        </div>
                        <div class="mt-3 d-flex justify-content-between align-items-center">
                            <span class="text-muted">Tổng cộng:</span>
                            <h4 id="modalTotalPrice" class="text-danger fw-bold mb-0">0₫</h4>
                        </div>
                    </div>

                    <div class="alert alert-info border-0 mb-0" style="background-color: #e3f2fd; color: #0d47a1;">
                        <i class="fa-solid fa-circle-info me-2"></i> Số dư sẽ được trừ trực tiếp vào ví sau khi xác nhận.
                    </div>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-light px-4 py-2 fw-semibold" data-bs-dismiss="modal" style="border-radius: 10px;">Hủy bỏ</button>
                    <button type="button" class="btn btn-primary px-5 py-2 fw-semibold shadow-sm" onclick="confirmPayment()" style="border-radius: 10px;">Xác nhận đặt món</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Success Modal -->
    <div class="modal fade" id="qrModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-body text-center p-5">
                    <div class="mb-4">
                        <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 70px; height: 70px;">
                            <i class="fa-solid fa-check fa-2xl"></i>
                        </div>
                        <h3 class="fw-bold text-success">Đặt món thành công!</h3>
                        <p class="text-muted">Vui lòng lưu lại mã QR dưới đây và đưa cho nhân viên canteen để nhận món.</p>
                    </div>
                    
                     <div class="qr-container p-3 bg-white border rounded-4 mb-4 shadow-sm">
                        <img id="purchaseQrCode" src="" alt="QR Code" class="img-fluid" style="max-width: 250px;">
                        <div id="foodQrCountdown" class="mt-3 fw-bold text-danger" style="font-size: 1.1rem;">
                            Hết hạn sau: <span id="foodTimer">15:00</span>
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary w-100 py-3 fw-bold" onclick="location.reload()" style="border-radius: 15px;">Đã hiểu, Quay lại</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/asset/js/food.js"></script>
